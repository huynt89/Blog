<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tech News Admin - Password Access</title>
    <link rel="stylesheet" href="assets/style.css">
    <style>
        .admin-form { max-width: 600px; margin: 30px auto; padding: 25px; background: #fff; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input, textarea, select { width: 100%; margin-bottom: 12px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; }
        .btn-post { background: #28a745; color: white; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 6px; }
        #auth-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; justify-content:center; align-items:center; z-index:1000; }
        .auth-card { background:white; padding:30px; border-radius:8px; text-align:center; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card">
        <h3>Hệ thống quản trị</h3>
        <input type="password" id="admin-password" placeholder="Nhập mật khẩu quản trị">
        <button class="btn-post" style="background:#007bff" onclick="unlockAdmin()">Vào quản lý</button>
    </div>
</div>

<div class="admin-form">
    <h2>Đăng bài mới</h2>
    <input type="text" id="title" placeholder="Tiêu đề bài viết">
    <select id="category">
        <option value="PC">PC</option>
        <option value="MAC">MAC</option>
        <option value="Mobile">Mobile</option>
        <option value="Other">Other</option>
    </select>
    <input type="text" id="image" placeholder="Tên file ảnh (vd: laptop.jpg)">
    <textarea id="content" rows="10" placeholder="Nội dung bài viết..."></textarea>
    <button class="btn-post" onclick="uploadToGithub()">XUẤT BẢN NGAY</button>
    <div id="status" style="margin-top:15px; text-align:center;"></div>
</div>

<script>
    // CẤU HÌNH TẠI ĐÂY
    const ENCODED_TOKEN = "Z2hwX0FCQzEyMw=="; // Thay bằng Token Base64 của bạn
    const REPO = "huynt89/Blog"; // Thay bằng repo của bạn
    const MY_PASS = "123456"; // Mật khẩu bạn tự đặt
    
    let decodedToken = "";

    function unlockAdmin() {
        const pass = document.getElementById('admin-password').value;
        if(pass === MY_PASS) {
            decodedToken = atob(ENCODED_TOKEN); // Giải mã Token
            document.getElementById('auth-overlay').style.display = 'none';
        } else {
            alert("Mật khẩu sai!");
        }
    }

    async function uploadToGithub() {
        const title = document.getElementById('title').value;
        const category = document.getElementById('category').value;
        const image = document.getElementById('image').value;
        const content = document.getElementById('content').value;
        const status = document.getElementById('status');

        if(!title || !content) return alert("Vui lòng điền đủ thông tin!");

        status.innerText = "Đang kết nối GitHub...";
        const date = new Date().toISOString().split('T')[0];
        const slug = title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '-').replace(/[^\w-]+/g, '');
        
        const fileName = `data${category}_${slug}_${date}.js`;
        const filePath = `Pages/${category}/${fileName}`;
        const fileJsContent = `window.techPosts.push({ title: "${title}", category: "${category}", date: "${date}", image: "Pages/${category}/img/${image}", content: \`${content.replace(/`/g, '\\`')}\` });`;

        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${filePath}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${decodedToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: `Post: ${title}`,
                    content: btoa(unescape(encodeURIComponent(fileJsContent)))
                })
            });

            if (res.ok) {
                status.innerText = "✅ Thành công! Đang đợi hệ thống cập nhật...";
                status.style.color = "green";
                document.getElementById('title').value = '';
                document.getElementById('content').value = '';
            } else {
                status.innerText = "❌ Lỗi: Có thể Token đã hết hạn.";
            }
        } catch (error) { status.innerText = "❌ Lỗi kết nối!"; }
    }
</script>
</body>
</html>